{
  "project": "Ralph Orchestrator Web UI",
  "description": "Transform Ralph Orchestrator into a dual-interface system with CLI and modern web UI. Add multi-project management, real-time monitoring, Kanban task visualization, workflow editor, and git integration while preserving all existing CLI functionality.",
  "tasks": [
    {
      "id": "T-001",
      "title": "Audit existing architecture and identify refactoring boundaries",
      "description": "Analyze current codebase structure (cli.py, run.py, session.py, gates.py, agents/) to identify which logic must be extracted into services layer. Document current dependencies, coupling points, and event emission points needed for real-time updates. Map out how to preserve CLI functionality while making core logic reusable.",
      "acceptanceCriteria": [
        "Complete dependency map created showing all modules and their interactions",
        "List of logic to extract from cli.py, run.py into services layer documented",
        "Event emission points identified for WebSocket broadcasting (task start/stop, agent transitions, gate execution, signal detection)",
        "CLI preservation strategy documented (keep commands as thin wrappers)",
        "No breaking changes identified for existing CLI commands"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "requiresTests": false,
      "affectsFrontend": false
    },
    {
      "id": "T-002",
      "title": "Create services package with orchestration_service.py",
      "description": "Create ralph_orchestrator/services/ package and extract core orchestration logic from run.py into orchestration_service.py. The service should be CLI-agnostic, have no Click dependencies, and emit events at key execution points (task start, agent transition, gate execution, signal detection). Maintain all existing RunEngine behavior.",
      "acceptanceCriteria": [
        "ralph_orchestrator/services/ package created with __init__.py",
        "orchestration_service.py created with OrchestrationService class",
        "All core task execution logic extracted from run.py into service",
        "Service has no Click dependencies (CLI-agnostic)",
        "Event hooks added for: task_started, task_completed, agent_phase_changed, gate_running, gate_completed, signal_detected",
        "Existing CLI 'ralph run' command works unchanged using new service",
        "All existing unit tests for run.py pass"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-003",
      "title": "Create project discovery and session management services",
      "description": "Create project_service.py to discover all directories with .ralph/ subdirectories and provide project metadata. Create session_service.py to handle session CRUD operations (enhanced from existing session.py). Both services should emit events for state changes and be usable by both CLI and API.",
      "acceptanceCriteria": [
        "project_service.py created with ProjectService class",
        "ProjectService.discover_projects() scans filesystem for .ralph/ directories",
        "ProjectService returns project metadata (name, path, branch, task count, status)",
        "session_service.py created with SessionService class",
        "SessionService provides CRUD operations for session data",
        "SessionService emits events when session state changes",
        "File watching capability added to detect new/removed projects",
        "Both services have comprehensive unit tests"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-004",
      "title": "Create config and git services",
      "description": "Create config_service.py to handle ralph.yml CRUD operations (enhanced from config.py) with validation. Create git_service.py to handle git operations (branch creation, switching, PR creation via GitHub/GitLab API). Both services emit events and are CLI-agnostic.",
      "acceptanceCriteria": [
        "config_service.py created with ConfigService class",
        "ConfigService provides get/update operations for ralph.yml",
        "ConfigService validates against JSON schema before saving",
        "ConfigService emits events on config changes",
        "git_service.py created with GitService class",
        "GitService supports branch operations (list, create, switch, delete)",
        "GitService supports PR creation with template-based descriptions",
        "GitService handles git credentials securely",
        "Both services have unit tests with mocked filesystem/git operations"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-005",
      "title": "Implement event system for real-time broadcasting",
      "description": "Create server/events.py with event type definitions and event emitter/subscriber pattern. Design event schema for all UI updates (task started/completed, agent output, gate execution, signal detection). Implement event queue and broadcasting mechanism that will integrate with WebSocket layer.",
      "acceptanceCriteria": [
        "server/events.py created with Event base class",
        "Event types defined: TaskStarted, TaskCompleted, AgentOutput, AgentPhaseChanged, GateRunning, GateCompleted, SignalDetected, SessionChanged, ConfigChanged",
        "Each event includes: type, project_id, timestamp, and type-specific data",
        "EventEmitter class implemented with subscribe/emit methods",
        "EventQueue class for buffering events before WebSocket broadcast",
        "All services (orchestration, session, config, git) integrated with event emitter",
        "Unit tests verify events emitted at correct times with correct data"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-006",
      "title": "Create FastAPI application with REST endpoints",
      "description": "Create server/api.py with FastAPI application. Implement all REST endpoints for project management, task operations, config management, git operations, logs, and timeline. Endpoints should call services layer and return JSON responses. Add CORS, error handling, and input validation.",
      "acceptanceCriteria": [
        "server/api.py created with FastAPI app instance",
        "GET /api/projects endpoint returns all discovered projects",
        "GET /api/projects/{project_id} returns project details",
        "GET /api/projects/{project_id}/tasks returns tasks from prd.json",
        "POST /api/projects/{project_id}/run starts task execution",
        "POST /api/projects/{project_id}/stop cancels execution",
        "GET /api/projects/{project_id}/config returns ralph.yml contents",
        "PUT /api/projects/{project_id}/config updates and validates ralph.yml",
        "GET /api/projects/{project_id}/branches lists git branches with status",
        "POST /api/projects/{project_id}/branches creates new branch",
        "POST /api/projects/{project_id}/pr creates pull request",
        "GET /api/projects/{project_id}/logs returns log files",
        "GET /api/projects/{project_id}/timeline returns timeline.jsonl events",
        "CORS configured for localhost development",
        "All endpoints have proper error handling with appropriate HTTP status codes",
        "Request validation using Pydantic models"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-007",
      "title": "Implement WebSocket manager for real-time updates",
      "description": "Create server/websocket.py with WebSocket connection manager. Handle client connections per project, broadcast events to subscribed clients, implement bidirectional messaging (client commands, server updates), and handle reconnection logic. Integrate with event system from T-005.",
      "acceptanceCriteria": [
        "server/websocket.py created with WebSocketManager class",
        "WebSocket endpoint /ws/{project_id} accepts connections",
        "Connection manager tracks active connections per project",
        "Server-to-client events: task_started, agent_output, gate_running, signal_detected, etc.",
        "Client-to-server commands: start_task, cancel_execution, create_branch",
        "Event broadcasting sends events only to clients subscribed to that project",
        "Graceful handling of client disconnects",
        "Heartbeat/ping-pong for connection health monitoring",
        "Integration tests verify bidirectional communication"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-008",
      "title": "Add 'ralph serve' CLI command",
      "description": "Add 'serve' subcommand to cli.py that starts the FastAPI server with uvicorn. Support options for port, host, projects-root, auto-open browser, and remote access. Command should initialize services, start project discovery, and launch web server. Update CLI to refactor existing commands to use services layer.",
      "acceptanceCriteria": [
        "cli.py updated with 'serve' subcommand using Click",
        "Options: --port (default 3000), --host (default 127.0.0.1), --projects-root (default current dir), --open (auto-open browser), --remote (bind to 0.0.0.0)",
        "Warning displayed when --remote flag enables remote connections",
        "Command initializes ProjectService with projects-root",
        "Command starts uvicorn server with FastAPI app",
        "Browser auto-opens to http://localhost:{port} if --open flag set",
        "Server logs display startup message with URL",
        "Existing CLI commands (run, scan, init, verify) refactored to call services layer",
        "All existing CLI integration tests pass unchanged"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-009",
      "title": "Initialize frontend Next.js application",
      "description": "Create frontend/ directory with Next.js 15+ application. Configure TypeScript, Tailwind CSS, shadcn/ui component library. Set up project structure (src/components, src/pages, src/services, src/hooks). Configure build to output to server/static/ for serving bundled assets from FastAPI.",
      "acceptanceCriteria": [
        "frontend/ directory created at repository root",
        "package.json with Next.js 15+, React 19+, TypeScript, Tailwind CSS",
        "tsconfig.json configured for strict TypeScript",
        "tailwind.config.js configured with design system",
        "shadcn/ui components library initialized",
        "src/components/ directory with base layout components",
        "src/pages/ directory with routing structure",
        "src/services/api.ts with REST API client (using fetch or axios)",
        "src/hooks/ directory created for custom hooks",
        "next.config.js configured to output build to ../ralph_orchestrator/server/static/",
        "npm run dev starts development server on port 3001",
        "npm run build produces production bundle"
      ],
      "priority": 6,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-010",
      "title": "Build multi-project dashboard UI",
      "description": "Create ProjectList component showing all discovered projects in grid/list view. Each project card shows name, branch, task count, status, last activity. Implement quick actions (open project, start autopilot). Add global search and filters. Connect to GET /api/projects endpoint and WebSocket for real-time updates.",
      "acceptanceCriteria": [
        "src/pages/index.tsx created as dashboard landing page",
        "src/components/ProjectList.tsx component displays grid of project cards",
        "ProjectCard component shows: project name, current branch, task counts (pending/in-progress/completed), status badge, last activity timestamp",
        "Quick actions on each card: Open (navigate to detail), Start Autopilot",
        "Global search filters projects by name",
        "Status filter (active, idle, errors)",
        "Toggle between grid and list view",
        "WebSocket connection updates project status in real-time without refresh",
        "Loading states and empty state handled",
        "Responsive design works on mobile/tablet"
      ],
      "priority": 7,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-011",
      "title": "Build Kanban task board with drag-and-drop",
      "description": "Create TaskBoard component with three columns (To Do, In Progress, Done). Display tasks from prd.json as draggable cards. Each card shows title, description, acceptance criteria, current agent, status. Implement drag-and-drop reordering. Connect to GET /api/projects/{id}/tasks and WebSocket for real-time task status updates. Add task actions (start, skip, delete).",
      "acceptanceCriteria": [
        "src/components/TaskBoard.tsx component with three columns",
        "TaskCard component displays: title, truncated description (expandable), acceptance criteria checklist, current agent indicator, duration/timestamp",
        "Drag-and-drop implemented using react-dnd or dnd-kit library",
        "Tasks can be reordered within To Do column (persists to prd.json)",
        "Click task card to expand and see full details + live agent output",
        "Start Task button triggers POST /api/projects/{id}/run",
        "Real-time updates via WebSocket move tasks between columns automatically",
        "Visual indicators when agent is running (pulsing icon)",
        "Skip and Delete task actions implemented",
        "Loading and error states handled gracefully"
      ],
      "priority": 7,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-012",
      "title": "Build workflow editor and config management UI",
      "description": "Create WorkflowEditor component visualizing agent pipeline as connected nodes (Implementation → Test → Gates → Review). Allow drag-and-drop to add/remove agents from palette. Create ConfigEditor component with split-pane view (visual form editor left, YAML preview right) for ralph.yml editing. Both components save changes via PUT /api/projects/{id}/config endpoint with validation.",
      "acceptanceCriteria": [
        "src/components/WorkflowEditor.tsx displays pipeline as visual flowchart",
        "Agent nodes show: name, type, guardrails summary",
        "Agent palette sidebar with draggable agent types",
        "Click agent node to configure (modal with prompt, guardrails settings)",
        "Gate nodes show command and status",
        "Add/remove gate buttons with configuration form",
        "Save button persists pipeline to ralph.yml via API",
        "src/components/ConfigEditor.tsx with split-pane layout",
        "Left pane: form editor for common settings (task_source, gates, services)",
        "Right pane: live YAML preview updates as form changes",
        "Validation against JSON schema before save (shows errors)",
        "Save and Reset buttons",
        "Both components handle loading and error states"
      ],
      "priority": 8,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-013",
      "title": "Build git integration UI and log viewer",
      "description": "Create GitPanel component showing current branch, list of all branches with status (commits ahead/behind, last commit). Add actions for branch creation, switching, deletion, and PR creation. Create LogViewer component for real-time log streaming with search, filters, and ANSI color support. Both connect to respective API endpoints and WebSocket for live updates.",
      "acceptanceCriteria": [
        "src/components/GitPanel.tsx displays current branch prominently",
        "Branch list shows: name, commits ahead/behind remote, last commit message, timestamp",
        "Create Branch button with name template input",
        "Switch Branch dropdown/action",
        "Delete Branch action with confirmation",
        "Create PR button opens modal: title (auto-generated), description (from acceptance criteria), one-click creation via POST /api/projects/{id}/pr",
        "PR creation success shows link to GitHub/GitLab PR",
        "src/components/LogViewer.tsx streams logs in real-time via WebSocket",
        "Filters: by agent type, by gate, by log level, by time range",
        "Search functionality highlights matches",
        "ANSI color codes rendered correctly",
        "Auto-scroll toggle",
        "Download logs button exports as text file"
      ],
      "priority": 8,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-014",
      "title": "Build timeline visualization and WebSocket hook",
      "description": "Create Timeline component visualizing events from timeline.jsonl as chronological stream with markers. Implement useWebSocket custom hook for managing WebSocket connections, auto-reconnect, event subscription, and optimistic updates. Integrate WebSocket throughout all components for real-time updates.",
      "acceptanceCriteria": [
        "src/components/Timeline.tsx displays events chronologically",
        "Visual markers for: task started/completed, agent transitions, gate execution (pass/fail), signals, errors",
        "Click event to expand and see full details",
        "Filter by event type",
        "Zoom controls (hourly/daily views)",
        "Export timeline button (JSON/CSV)",
        "src/hooks/useWebSocket.ts custom hook created",
        "useWebSocket(projectId) manages connection lifecycle",
        "Auto-reconnect logic with exponential backoff",
        "Event subscription system (subscribe to specific event types)",
        "Hook returns: connected state, events stream, sendMessage function",
        "All components (TaskBoard, LogViewer, Timeline, ProjectList) use useWebSocket",
        "Real-time updates work without page refresh",
        "UI shows connection status (connected/reconnecting/disconnected)"
      ],
      "priority": 9,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    },
    {
      "id": "T-015",
      "title": "Add comprehensive testing and documentation",
      "description": "Write backend tests (service layer unit tests, API integration tests, WebSocket tests). Write frontend tests (component unit tests, E2E tests with Playwright). Update documentation (README with ralph serve usage, architecture docs, API reference). Perform manual testing checklist. Ensure zero regression in existing CLI functionality.",
      "acceptanceCriteria": [
        "tests/services/ directory with unit tests for all services (orchestration, project, session, config, git)",
        "tests/integration/test_api.py with tests for all REST endpoints",
        "tests/integration/test_websocket.py with WebSocket lifecycle and broadcasting tests",
        "frontend/src/__tests__/ with component unit tests (Jest/React Testing Library)",
        "frontend/e2e/ with Playwright tests covering: start task, monitor progress, create branch/PR, edit config",
        "README.md updated with ralph serve documentation and examples",
        "docs/architecture.md created documenting service layer, event system, API design",
        "docs/api.md with OpenAPI/Swagger documentation for all endpoints",
        "All existing CLI integration tests pass (no regressions)",
        "Manual testing checklist completed and documented",
        "Test coverage >80% for new code"
      ],
      "priority": 10,
      "passes": true,
      "notes": "",
      "requiresTests": true,
      "affectsFrontend": false
    }
  ],
  "branchName": "ralph/cr-chat-20260126-173014",
  "version": "1",
  "metadata": {
    "updatedAt": "2026-01-28T09:18:48.984764Z",
    "source": "imported-cr",
    "sourceFile": "/Users/edouardgouilliard/Documents/Leyton/CAES/ralph-orchestrator/changes/CR-chat-20260126-173014.md"
  }
}
