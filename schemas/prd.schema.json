{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ralph-orchestrator.dev/schemas/prd.schema.json",
  "title": "Ralph PRD Schema",
  "description": "Canonical schema for Ralph orchestrator task list (prd.json). Compatible with Compound Product format with optional extensions.",
  "type": "object",
  "required": ["project", "description", "tasks"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference URL",
      "format": "uri"
    },
    "project": {
      "type": "string",
      "description": "Project or feature name",
      "minLength": 1,
      "maxLength": 200
    },
    "branchName": {
      "type": "string",
      "description": "Git branch name (kebab-case recommended)",
      "pattern": "^[a-zA-Z0-9][a-zA-Z0-9/_-]*$",
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "description": "One-line description of the work",
      "minLength": 1,
      "maxLength": 500
    },
    "version": {
      "type": "string",
      "description": "Schema version for forward compatibility (default: 1)",
      "enum": ["1"],
      "default": "1"
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata for tracking and provenance",
      "properties": {
        "createdAt": {
          "type": "string",
          "description": "ISO 8601 timestamp when task list was created",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp when task list was last modified",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "Origin of tasks (manual, autopilot, imported-cr)",
          "enum": ["manual", "autopilot", "imported-cr", "imported-prd"]
        },
        "sourceFile": {
          "type": "string",
          "description": "Path to source file if imported"
        },
        "author": {
          "type": "string",
          "description": "Author or generator of the task list"
        }
      },
      "additionalProperties": true
    },
    "tasks": {
      "type": "array",
      "description": "List of tasks to execute",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/Task"
      }
    }
  },
  "definitions": {
    "Task": {
      "type": "object",
      "description": "A single executable task",
      "required": ["id", "title", "description", "acceptanceCriteria", "priority", "passes"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Stable task identifier (T-001 format)",
          "pattern": "^T-[0-9]{3}$"
        },
        "title": {
          "type": "string",
          "description": "Short, action-oriented title",
          "minLength": 1,
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "description": "What to do and why",
          "minLength": 1,
          "maxLength": 2000
        },
        "acceptanceCriteria": {
          "type": "array",
          "description": "Boolean/verifiable criteria for completion",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 500
          }
        },
        "priority": {
          "type": "integer",
          "description": "Execution order (lower = earlier)",
          "minimum": 1,
          "maximum": 999
        },
        "passes": {
          "type": "boolean",
          "description": "Completion status (script-controlled, agents must not modify)"
        },
        "notes": {
          "type": "string",
          "description": "Evidence, links, or context logged by agents",
          "default": "",
          "maxLength": 5000
        },
        "requiresTests": {
          "type": "boolean",
          "description": "Whether this task requires automated tests. Set to false for analysis, documentation, or configuration tasks.",
          "default": true
        },
        "affectsFrontend": {
          "type": "boolean",
          "description": "Whether this task modifies frontend code. Triggers UI testing when true and frontend service is configured.",
          "default": false
        },
        "skill": {
          "type": ["string", "null"],
          "description": "Explicit Claude skill to use for this task (overrides auto-detection). Use null or omit for auto-detection.",
          "enum": ["frontend-design", "docx", "xlsx", "pptx", "pdf", "mcp-builder", null]
        },
        "subtasks": {
          "type": "array",
          "description": "Optional subtask breakdown for complex tasks",
          "items": {
            "$ref": "#/definitions/Subtask"
          }
        }
      },
      "additionalProperties": false
    },
    "Subtask": {
      "type": "object",
      "description": "A subtask within a parent task. Supports checkpoint mode (default) where single agent signals progress, or independent mode where subtask gets own verification loop.",
      "required": ["id", "title", "acceptanceCriteria", "passes"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Subtask ID (T-001.1 format)",
          "pattern": "^T-[0-9]{3}\\.[0-9]+$"
        },
        "title": {
          "type": "string",
          "description": "Short subtask title",
          "minLength": 1,
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "description": "Optional detailed description of the subtask",
          "default": "",
          "maxLength": 2000
        },
        "acceptanceCriteria": {
          "type": "array",
          "description": "Criteria for this subtask",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 500
          }
        },
        "passes": {
          "type": "boolean",
          "description": "Completion status (script-controlled)"
        },
        "notes": {
          "type": "string",
          "description": "Subtask notes",
          "default": "",
          "maxLength": 2000
        },
        "independent": {
          "type": "boolean",
          "description": "If true, subtask gets its own verification loop with review. Default false (checkpoint mode).",
          "default": false
        },
        "promotedTo": {
          "type": ["string", "null"],
          "description": "Task ID if this subtask was promoted to a full task via escalation",
          "pattern": "^T-[0-9]{3}$"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
