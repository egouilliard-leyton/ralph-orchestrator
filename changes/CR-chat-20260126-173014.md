# Change Request: Web UI for Ralph Orchestrator

**Created:** 2026-01-26
**Status:** Proposed
**Priority:** High

---

## Summary

Transform Ralph Orchestrator from a CLI-only tool into a dual-interface system with both CLI and web UI capabilities. Add a modern web frontend with multi-project management, real-time monitoring, Kanban task visualization, and full workflow control while preserving all existing CLI functionality.

---

## Current Behavior

Ralph Orchestrator is a pure CLI tool:
- All commands executed via terminal (`ralph run`, `ralph scan`, etc.)
- Session state stored in `.ralph-session/` directory
- No visual interface for monitoring task progress
- No way to see multiple projects at once
- No real-time visibility into agent execution
- Configuration changes require manual YAML editing
- No integration with git workflows (branch creation, PR submission)
- Cannot dynamically add/remove agents from workflows

---

## Desired Behavior

### Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                     User Interfaces                          │
│  ┌──────────────────┐           ┌─────────────────────────┐ │
│  │   CLI Commands   │           │   Web UI (Browser)      │ │
│  │   ralph run      │           │   localhost:3000        │ │
│  │   ralph scan     │           │   - Dashboard           │ │
│  │   ralph serve    │           │   - Task Board          │ │
│  └────────┬─────────┘           │   - Real-time Monitor   │ │
│           │                     └──────────┬──────────────┘ │
└───────────┼────────────────────────────────┼────────────────┘
            │                                │
            └────────────┬───────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                   Core Services Layer                        │
│  ┌──────────────┐  ┌───────────────┐  ┌─────────────────┐  │
│  │ Orchestration│  │  Project Mgmt │  │  Session Mgmt   │  │
│  │   Service    │  │   Service     │  │    Service      │  │
│  └──────────────┘  └───────────────┘  └─────────────────┘  │
│  ┌──────────────┐  ┌───────────────┐  ┌─────────────────┐  │
│  │   Agent      │  │  Gate Runner  │  │  Git Service    │  │
│  │   Manager    │  │   Service     │  │                 │  │
│  └──────────────┘  └───────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────┘
            │                                │
            ▼                                ▼
┌─────────────────────────────────────────────────────────────┐
│              Backend API Server (FastAPI)                    │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  REST API         │  WebSocket Handler               │   │
│  │  /api/projects    │  /ws (bidirectional real-time)   │   │
│  │  /api/tasks       │                                  │   │
│  │  /api/config      │                                  │   │
│  │  /api/git         │                                  │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### New Command: `ralph serve`

```bash
ralph serve [OPTIONS]

Options:
  --port INTEGER        Port to run server on [default: 3000]
  --host TEXT          Host to bind to [default: 127.0.0.1]
  --projects-root TEXT Directory to scan for projects [default: current dir]
  --open              Open browser automatically
  --remote            Allow remote connections (binds to 0.0.0.0)

Examples:
  ralph serve                        # Start on localhost:3000
  ralph serve --projects-root ~/dev  # Manage all projects in ~/dev
  ralph serve --port 8080 --open     # Custom port, auto-open browser
```

Starts a web server that:
- Discovers all directories with `.ralph/` subdirectories
- Serves the web UI on specified port
- Establishes WebSocket connections for real-time updates
- Monitors filesystem for `.ralph-session/` changes
- Broadcasts events to connected clients

### Web UI Features

#### 1. Multi-Project Dashboard

**View:** Landing page showing all discovered projects

**Features:**
- Grid/list view of all projects with `.ralph/` directories
- Each project card shows:
  - Project name (derived from directory name)
  - Current branch
  - Active tasks count (pending/in-progress/completed)
  - Last activity timestamp
  - Health status (gates passing, agents running, idle)
- Quick actions per project:
  - Open project detail view
  - Start autopilot
  - Open in terminal (deep link to CLI)
- Global search across all projects
- Filter by status (active, idle, errors)

#### 2. Project Detail View

**View:** Single project workspace (full-screen)

**Layout:**
```
┌────────────────────────────────────────────────────────────┐
│ [← Projects]  project-name (master) ⚡ Running             │
├────────────────────────────────────────────────────────────┤
│ Tabs: [Tasks] [Workflow] [Config] [Git] [Logs] [Timeline] │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  [Tab Content - see below]                                 │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

##### 2.1 Tasks Tab (Kanban View)

Three columns: **To Do | In Progress | Done**

Each task card shows:
- Task title from PRD
- Description (truncated, expandable)
- Acceptance criteria checklist
- Current agent working on it (if in progress)
- Real-time status updates (agent phase, gate execution)
- Duration/timestamps
- Expand to see live agent output

Interactions:
- Drag-and-drop to reorder (within To Do column)
- Click to expand and see full details
- "Start Task" button (triggers `ralph run` for that task)
- "Skip Task" / "Delete Task" actions
- Real-time updates via WebSocket as agents progress

##### 2.2 Workflow Tab (Agent Pipeline Editor)

**Visual pipeline editor:**

```
[Implementation Agent] → [Test Writing Agent] → [Build Gate] → [Test Gate] → [Review Agent]
                                                      ↓              ↓
                                                   [lint]       [pytest]
```

Features:
- Drag-and-drop to add agents from palette
- Click agent to configure:
  - Prompts/instructions
  - Guardrails
  - Session token requirements
- Add/remove quality gates
- Configure gate commands
- Reorder pipeline stages
- Save button persists to `ralph.yml`
- Visual indicators for active stage during execution

**Agent Palette:**
- Implementation Agent (default)
- Test Writing Agent (default)
- Review Agent (default)
- Custom Agent (user-defined prompt + guardrails)
- Future: Plugin agents (linting, security scanning, docs generation)

##### 2.3 Config Tab (ralph.yml Editor)

Split view:
- **Left pane:** Visual form editor for common settings
  - Task source configuration
  - Gate definitions (build/full)
  - Services configuration
  - Guardrails settings
- **Right pane:** Live YAML preview
- Validation as you type (JSON schema validation)
- Save button with confirmation
- Reset/undo functionality

##### 2.4 Git Tab (Branch & PR Management)

**Features:**
- Current branch display
- List all local branches with status:
  - Commits ahead/behind remote
  - Last commit message
  - Timestamp
- Actions:
  - Create new branch (with naming template)
  - Switch branch
  - Delete branch
  - Push to remote
  - Create Pull Request:
    - Title auto-generated from task
    - Description from acceptance criteria
    - Link to Ralph session logs
    - One-click creation via GitHub/GitLab API

**Future automation capabilities:**
- Auto-create feature branch when task starts
- Auto-commit after each agent phase
- Auto-push after task completion
- Auto-create PR with task details

##### 2.5 Logs Tab (Searchable Log Viewer)

**Features:**
- Combined view of all agent logs and gate outputs
- Real-time streaming via WebSocket
- Filters:
  - By agent type (implementation, test, review)
  - By gate (build, test)
  - By log level (info, warning, error)
  - By time range
- Search functionality
- Download logs as text file
- ANSI color support for terminal output
- Auto-scroll option (toggle)

##### 2.6 Timeline Tab (Event Visualization)

**Features:**
- Chronological event stream from `timeline.jsonl`
- Visual timeline with markers for:
  - Task started/completed
  - Agent phase transitions
  - Gate executions (pass/fail)
  - Signal emissions
  - Errors/warnings
- Click event to see full details
- Filter by event type
- Zoom in/out (hourly, daily views)
- Export timeline as JSON/CSV

#### 3. Real-Time Monitoring

**WebSocket Events:**

All UI updates happen in real-time via WebSocket:

```javascript
// Events from backend to frontend
{
  "type": "task_started",
  "project": "ralph-orchestrator",
  "task_id": "task-001",
  "timestamp": "2026-01-26T17:30:00Z"
}

{
  "type": "agent_output",
  "project": "ralph-orchestrator",
  "agent": "implementation",
  "output": "Modifying file: src/api.py",
  "timestamp": "2026-01-26T17:30:15Z"
}

{
  "type": "gate_running",
  "project": "ralph-orchestrator",
  "gate": "lint",
  "command": "ruff check .",
  "timestamp": "2026-01-26T17:31:00Z"
}

{
  "type": "signal_detected",
  "project": "ralph-orchestrator",
  "signal": "task-done",
  "session": "ralph-20260126-173000-abc123",
  "valid": true,
  "timestamp": "2026-01-26T17:32:00Z"
}

// Events from frontend to backend
{
  "type": "start_task",
  "project": "ralph-orchestrator",
  "task_id": "task-001"
}

{
  "type": "cancel_execution",
  "project": "ralph-orchestrator",
  "reason": "User requested stop"
}

{
  "type": "create_branch",
  "project": "ralph-orchestrator",
  "branch_name": "feature/add-web-ui"
}
```

**UI Indicators:**
- Pulsing icon when agent is running
- Progress bars for gate execution
- Toast notifications for completed tasks
- Error banners for failed gates
- Live token count / API usage (if available)

#### 4. PRD Management

**Features:**
- Visual PRD editor (alternative to JSON editing)
- Form-based task creation:
  - Title
  - Description (markdown editor)
  - Acceptance criteria (checklist builder)
  - Priority
  - Dependencies
- Import from existing `prd.json`
- Export to `prd.json`
- Template library for common task types

---

## Affected Areas

### New Modules (to be created)

1. **`ralph_orchestrator/server/`** - Web server package
   - `api.py` - FastAPI application, REST endpoints
   - `websocket.py` - WebSocket connection manager
   - `events.py` - Event broadcasting system
   - `discovery.py` - Project discovery service
   - `static/` - Bundled frontend build

2. **`ralph_orchestrator/services/`** - Refactored core logic
   - `orchestration_service.py` - Extract logic from `run.py`
   - `project_service.py` - Project management operations
   - `session_service.py` - Session CRUD, enhanced from `session.py`
   - `git_service.py` - Git operations (branch, commit, PR)
   - `config_service.py` - Config CRUD, enhanced from `config.py`

3. **`frontend/`** - React/Next.js application (new root directory)
   - `src/components/` - React components
   - `src/pages/` - Page routes
   - `src/hooks/useWebSocket.ts` - WebSocket client hook
   - `src/services/api.ts` - REST API client
   - `package.json` - Node dependencies

### Modified Modules

1. **`ralph_orchestrator/cli.py`**
   - Add `serve` subcommand
   - Refactor existing commands to use service layer
   - Keep thin wrapper around services

2. **`ralph_orchestrator/run.py`**
   - Extract `RunEngine` logic into `orchestration_service.py`
   - Emit events for WebSocket broadcasting
   - Keep CLI-specific code minimal

3. **`ralph_orchestrator/session.py`**
   - Add event hooks for session state changes
   - Fire events when session data is written

4. **`ralph_orchestrator/gates.py`**
   - Add event hooks for gate execution start/stop
   - Stream output for real-time display

5. **`ralph_orchestrator/agents/claude.py`**
   - Add streaming output capability
   - Fire events for agent phase transitions

6. **`pyproject.toml`**
   - Add new dependencies:
     - `fastapi` - Web framework
     - `uvicorn` - ASGI server
     - `websockets` - WebSocket support
     - `watchfiles` - File watching for project discovery
     - `python-multipart` - Form data handling
     - `aiofiles` - Async file operations

### Configuration Schema

**Update `schemas/ralph-config.schema.json`:**

Add optional `server` section:

```json
{
  "server": {
    "port": 3000,
    "host": "127.0.0.1",
    "projects_root": ".",
    "auto_open_browser": true,
    "enable_remote": false
  }
}
```

---

## Technical Implementation Plan

### Phase 1: Backend Infrastructure

1. **Service Layer Refactoring**
   - Extract core logic from CLI modules into `services/`
   - Ensure services are CLI-agnostic (no `click` dependencies)
   - Add event emission hooks throughout services
   - Update CLI commands to call services

2. **FastAPI Server Setup**
   - Create FastAPI app in `server/api.py`
   - Implement REST endpoints:
     - `GET /api/projects` - List all discovered projects
     - `GET /api/projects/{project_id}` - Get project details
     - `GET /api/projects/{project_id}/tasks` - Get tasks for project
     - `POST /api/projects/{project_id}/tasks` - Create new task
     - `PUT /api/projects/{project_id}/tasks/{task_id}` - Update task
     - `POST /api/projects/{project_id}/run` - Start task execution
     - `POST /api/projects/{project_id}/stop` - Stop execution
     - `GET /api/projects/{project_id}/config` - Get ralph.yml
     - `PUT /api/projects/{project_id}/config` - Update ralph.yml
     - `GET /api/projects/{project_id}/branches` - List git branches
     - `POST /api/projects/{project_id}/branches` - Create branch
     - `POST /api/projects/{project_id}/pr` - Create pull request
     - `GET /api/projects/{project_id}/logs` - Get logs
     - `GET /api/projects/{project_id}/timeline` - Get timeline events

3. **WebSocket Implementation**
   - Create WebSocket manager in `server/websocket.py`
   - Handle client connections per project
   - Broadcast events to subscribed clients
   - Implement bidirectional message handling:
     - Client → Server: control commands (start, stop, cancel)
     - Server → Client: status updates (agent output, gate results)

4. **Project Discovery**
   - Scan filesystem for `.ralph/` directories
   - Watch for new projects appearing
   - Cache project metadata
   - Handle project removal gracefully

5. **Event System**
   - Define event types in `server/events.py`
   - Implement event emitters in all services
   - Queue events for WebSocket broadcast
   - Store events to timeline for replay

### Phase 2: Frontend Application

1. **Project Setup**
   - Initialize Next.js app in `frontend/`
   - Configure TypeScript, Tailwind CSS
   - Set up component library (shadcn/ui recommended)
   - Configure WebSocket client

2. **Core Components**
   - `ProjectList` - Dashboard grid/list
   - `ProjectDetail` - Main workspace layout
   - `TaskBoard` - Kanban columns with drag-and-drop
   - `TaskCard` - Individual task display
   - `WorkflowEditor` - Pipeline visualization
   - `ConfigEditor` - Split-pane YAML editor
   - `GitPanel` - Branch management
   - `LogViewer` - Real-time log streaming
   - `Timeline` - Event visualization

3. **WebSocket Integration**
   - Custom hook `useWebSocket(projectId)`
   - Auto-reconnect on disconnect
   - Event subscription system
   - Optimistic UI updates

4. **State Management**
   - Use React Context or Zustand for global state
   - Cache project list
   - Real-time sync with backend via WebSocket
   - Persist UI preferences (theme, layout)

### Phase 3: Git Integration

1. **Git Service**
   - Wrap `pygit2` or `GitPython`
   - Implement branch operations
   - Commit creation with Ralph metadata
   - Push to remote with credentials handling

2. **GitHub/GitLab API Integration**
   - PR creation via REST API
   - Template-based PR descriptions
   - Link to Ralph session logs
   - Auto-fill labels/assignees

3. **Automation Hooks**
   - Optional auto-branch creation on task start
   - Optional auto-commit after agent phases
   - Optional auto-PR creation on task completion
   - Configurable via `ralph.yml`

### Phase 4: Extensibility

1. **Dynamic Agent Configuration**
   - Agent registry system
   - Load custom agent definitions from config
   - Validate agent pipeline before execution
   - UI support for custom agents

2. **Plugin System** (future)
   - Define plugin interface
   - Allow third-party agent implementations
   - Discover plugins from Python packages
   - UI for plugin marketplace

---

## Testing Plan

### Backend Tests

1. **Service Layer Tests** (`tests/services/`)
   - Unit tests for all new services
   - Verify event emission
   - Test service interactions
   - Mock filesystem operations

2. **API Integration Tests** (`tests/integration/test_api.py`)
   - Test all REST endpoints
   - Verify request/response formats
   - Test authentication (if added)
   - Test error handling

3. **WebSocket Tests** (`tests/integration/test_websocket.py`)
   - Test connection lifecycle
   - Verify event broadcasting
   - Test bidirectional communication
   - Test reconnection logic

4. **Project Discovery Tests** (`tests/unit/test_discovery.py`)
   - Test multi-project scanning
   - Verify watch functionality
   - Test edge cases (nested .ralph/, symlinks)

### Frontend Tests

1. **Component Tests** (`frontend/src/__tests__/`)
   - Unit tests for all components
   - Snapshot tests for UI consistency
   - Test user interactions
   - Mock API calls

2. **Integration Tests** (`frontend/e2e/`)
   - Playwright/Cypress end-to-end tests
   - Test full user workflows:
     - Start task from UI
     - Monitor real-time progress
     - Create branch and PR
     - Edit configuration
   - Test WebSocket connection handling

3. **Visual Regression Tests**
   - Screenshot comparison
   - Test responsive layouts
   - Verify dark/light themes

### Manual Testing Checklist

- [ ] CLI remains fully functional after refactoring
- [ ] `ralph serve` starts and discovers projects
- [ ] Multi-project dashboard loads correctly
- [ ] Real-time updates appear without refresh
- [ ] Task execution can be started from UI
- [ ] Agent output streams in real-time
- [ ] Gates run and display results
- [ ] Configuration editor saves to ralph.yml
- [ ] Git operations work (branch creation, PR)
- [ ] WebSocket reconnects on disconnect
- [ ] UI responsive on mobile/tablet
- [ ] Logs searchable and downloadable
- [ ] Timeline shows complete history

---

## Acceptance Criteria

### Core Functionality

- [ ] All existing CLI commands work unchanged (no breaking changes)
- [ ] `ralph serve` command starts web server successfully
- [ ] Web UI accessible at http://localhost:3000
- [ ] Dashboard lists all projects with `.ralph/` directories
- [ ] Can navigate to project detail view
- [ ] Kanban board displays tasks from `prd.json`
- [ ] Real-time updates via WebSocket for agent output
- [ ] Can start task execution from UI
- [ ] Can stop/cancel execution from UI
- [ ] Live logs stream in real-time

### Configuration & Workflow

- [ ] Workflow tab displays current agent pipeline
- [ ] Can edit `ralph.yml` from UI
- [ ] Configuration validation prevents invalid saves
- [ ] Can add/remove agents from pipeline (future: custom agents)
- [ ] Can configure quality gates from UI

### Git Integration

- [ ] Git tab lists all branches with status
- [ ] Can create new branch from UI
- [ ] Can switch branches from UI
- [ ] Can create PR with auto-generated description
- [ ] PR includes link to Ralph session logs

### Real-Time Monitoring

- [ ] Task status updates without page refresh
- [ ] Agent phase transitions visible immediately
- [ ] Gate execution shows live progress
- [ ] Signals detected and displayed (task-done, tests-done, etc.)
- [ ] Timeline populates with events in real-time

### Multi-Project Support

- [ ] Can manage multiple projects from one UI instance
- [ ] Project discovery updates when new `.ralph/` directories added
- [ ] Can run tasks in multiple projects simultaneously
- [ ] Each project maintains independent session state

### User Experience

- [ ] UI loads in < 2 seconds
- [ ] No noticeable lag during real-time updates
- [ ] Error messages clear and actionable
- [ ] Responsive design works on tablet/mobile
- [ ] Dark mode supported
- [ ] Keyboard shortcuts for common actions

---

## Security Considerations

1. **Local-First Design**
   - Default bind to `127.0.0.1` (localhost only)
   - Remote access requires explicit `--remote` flag
   - Warning displayed when remote access enabled

2. **Authentication** (future)
   - If remote access needed, add token-based auth
   - Session tokens for WebSocket connections
   - Rate limiting on API endpoints

3. **File System Access**
   - Validate all file paths (prevent directory traversal)
   - Restrict config writes to valid YAML
   - Sanitize git operations (prevent command injection)

4. **WebSocket Security**
   - Validate all incoming messages
   - Rate limit control commands
   - Prevent XSS in log/output display

---

## Migration Path

### For Existing Users

1. **No breaking changes** - All CLI commands work as before
2. **Opt-in web UI** - Use `ralph serve` when desired
3. **Session compatibility** - Existing `.ralph-session/` directories work with UI
4. **Config compatibility** - `ralph.yml` remains valid (new `server` section optional)

### Rollout Plan

1. **Alpha release** - Backend + basic UI (project list, task board, logs)
2. **Beta release** - Add workflow editor, git integration, full real-time monitoring
3. **v1.0** - Complete feature set, comprehensive testing, documentation
4. **Future** - Plugin system, remote collaboration, analytics dashboard

---

## Open Questions

1. **Frontend Framework**: React/Next.js recommended for "modern view" - confirm acceptance?
2. **Authentication**: Do we need user authentication for local-only deployment?
3. **API Documentation**: Should we generate OpenAPI/Swagger docs for API?
4. **Theming**: Dark/light mode sufficient, or custom themes?
5. **Notifications**: Browser notifications when tasks complete?
6. **Mobile App**: Native mobile app in future, or PWA sufficient?
7. **Collaboration**: Multiple users editing same project - conflict resolution strategy?

---

## Success Metrics

- Zero regression in CLI functionality
- Web UI adoption rate among existing users
- Time saved managing multiple projects
- Reduction in terminal context-switching
- User feedback on workflow efficiency
- Performance (UI response time < 200ms for interactions)

---

## Notes

This is a significant architectural evolution that transforms Ralph from a CLI tool into a full-stack application. The key principles:

1. **Preserve CLI** - Don't break existing workflows
2. **Service-oriented** - Refactor for code reuse between CLI and API
3. **Real-time first** - WebSocket-driven UI for best UX
4. **Extensibility** - Design for future agent plugins and customization
5. **Local-first** - Optimize for single-user, local development
6. **Modern UX** - Professional, responsive, real-time interface

The multi-project management capability is a major value-add, allowing developers to oversee multiple Ralph-orchestrated repos from one unified interface.
